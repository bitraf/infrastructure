- name: Managing container {{ item.key }}
  lxc_container:
    name: "{{ item.key }}"
    state: started
    template: debian
    template_options: -r jessie --packages python
    container_log: true
    container_log_level: DEBUG
    container_config:
      - "lxc.network.type = veth"
      - "lxc.network.flags = up"
      - "lxc.network.link = {{ int_link }}"
      - "lxc.network.hwaddr = {{ item.value.mac }}"
      # 0 is all, default is 5 (error)
      - "lxc.network.ipv4 = {{ item.value.ipv4.address }}/24"
      - "lxc.network.ipv4.gateway = {{ int_ipv4 }}"
      - "lxc.loglevel = 0"
      - "lxc.logfile = /var/lib/lxc/{{ item.key }}/{{ item.key }}.log"
  register: lxc_create
- name: restart lxc container {{ item.key }}
  when: item.value.state == 'started' and lxc_create.changed
  lxc_container:
    name: "{{ item.key }}"
    state: restarted
- debug: var=lxc_create.stdout_lines
  when: lxc_create.stdout_lines is defined
- debug: var=lxc_create.stderr_lines
  when: lxc_create.stderr_lines is defined
