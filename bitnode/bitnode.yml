- hosts:
    - bitnode
  roles:
    - lusers
    - superusers
    - role: mediawiki-database
      credentials:
        username: mediawiki
        password: "{{Â mediawiki.db.password }}"
  vars_files:
    - ../group_vars/all/users.yml
    - ../group_vars/all/mediawiki.yml
    - ../group_vars/all/host_database.yml
  handlers:
    - name: systemctl restart systemd-networkd
      become: true
      systemd:
        name: systemd-networkd
        state: restarted
  tasks:
    - tags: packages
      become: true
      block:
        - copy:
            dest: /etc/apt/preferences.d/jessie-backports
            content: |
              Package: *
              Pin: release a=jessie-backports
              Pin-Priority: 500
        - name: apt install
          with_items:
            - ufw
          apt:
            name: "{{ item }}"
            install_recommends: false
    - import_tasks: network.yml
      tags: network
      become: true
      vars:
        int_link: br0
        int_ipv4: "{{ host_database.bitnode.interfaces.br0.ipv4 }}"
        int_ipv6: "{{ host_database.bitnode.interfaces.br0.ipv6 }}"

    - name: lxc-hosts
      import_role: name=lxc-host
      tags: lxc-host
      become: yes
